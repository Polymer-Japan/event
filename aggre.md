# SEO

- 検索エンジンはサーバーから返ってきた HTML をインデックスします
- 検索エンジンに限らず、Facebook や Twitter などの SNS、Slack などのチャット、それから未知のボットサービスもたいていは同じ仕組みでウェブサイトを解析します
- ( サーバーに HTML を問い合わせて、サーバーから完成された HTML が返ってくる図など )
- Polymer は JavaScript ライブラリです
- ボットは JavaScript を実行できません
- JavaScript が実行されないと HTML が完成しないため、Polymer はそのままではボットフレンドリーではありません
- これは Polymer に限らずほかの JavaScript ライブラリも同様です

# SSR

- この対策として SSR、Server Side Rendering という手法があります。
- Ruby や PHP のようにサーバー側で JavaScript を実行して、完成された HTML を返却します。

## SSR が必要なケース

- SSR は JavaScript アプリケーションをボットフレンドリーにするための手法です
- ボットに対してドキュメントとして認識される必要がないサービスであれば SSR は不要ともいえます
- サインインしないと情報にアクセスできないサービスのようなクローズドな場合は SSR は不要です
- 逆にオープンな情報を取り扱っている場合には SSR は必要になります

## どこを SSR するか？

- HTML 全体を SSR する
  - `<html>` から始まり `<head>` 、`<body>` の中まですべて SSR するケース
  - 対象のドキュメントが主に文章で成り立っている場合に必要な施策です
  - ブログや EC など
- `<head>` を SSR する
  - `<head>` 要素だけを SSR するケース
  - 対象のドキュメントがツールとして機能している場合に有効な施策です
  - オンラインエディタやミュージックプレイヤーのようなものなど

## SSR の手法

### `<head>` だけ SSR

- サーバー側のプログラムでリクエスト URL に合わせた `<title>` や `<meta>` 要素などを作成します
- これはサーバー側の言語を問わず実装できます

### HTML 全体

#### Node.js

- Node.js には `window` オブジェクトがないので、`window` のエミュレーターライブラリを使って疑似的にブラウザの実行環境を再現します
- Skate というライブラリが Node.js による Web Component の SSR を提供しています
- ( 具体的なコード例 )
- 高速に動作する代わりに、ブラウザの実行環境を完全再現はできないため、アプリケーションによっては実装が難しいです
- ブラウザのテストと SSR のテストどちらもパスさせないといけないのでコストがかかります

#### Browser in server

- 本当のブラウザをサーバー側で実行して、HTML をスクレイピングします
- Chrome は Headless モードで実行できるので、 サーバーに Chrome のバイナリをおいて、子プロセスで Chrome を実行します
- ( 具体的なコード例 )
- ブラウザ起動までのオーバーヘッドがあるため遅い代わりに、ブラウザとまったく同様の機能をもつためどのアプリケーションでも簡単に実装できます
- ブラウザのテストをパスすれば SSR も正常にできます

#### Slot

- Web Components の `<slot>` を活用します
- Slot は Custom Elements の内部で表現されますが、ドキュメントにそのまま記述できるためサーバー側で構築できます
- サーバー側の言語も問いません
- JavaScript によって作られる HTML 構造とサーバー側で生成する　HTML 構造が一致するように保たなければいけませんが、素直な実装で完結します

